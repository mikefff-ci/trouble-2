version: 2.1

jobs:
  vm:
    machine:
      image: ubuntu-1604:201903-01
      docker_layer_caching: true
    steps:
      - checkout
      - run: |
          docker system df
          echo '-------------'
          docker images -q
          echo '**************'
          docker images -q > /tmp/docker_images
          echo '##################'
          sed -i 1d /tmp/docker_images
          echo '-------------'
          echo /tmp/docker_images
          echo '==============='
          docker rmi $(cat /tmp/docker_images) || true
          echo '-------------'
          docker system df
      - run: |
          docker build .

workflows:
  wf:
    jobs:
      - vm
