version: 2.1

jobs:
  vm:
    machine:
      image: ubuntu-1604:201903-01
      docker_layer_caching: true
    steps:
      - checkout
      - run: |
          docker system df
          echo '-------------'
          docker images -q
          echo '-------------'
          tail -n +2 \<<< $(docker images -q)
          echo '-------------'
          docker rmi $(tail -n +2 \<<< $(docker images -q)) || true
          docker system df
      - run: |
          docker build .

workflows:
  wf:
    jobs:
      - vm
