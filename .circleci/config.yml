version: 2.1

parameters:
  testing:
    type: string
    default: unchanged

orbs:
  docker-cpu-profiling: mkly/docker-cpu-profiling@0.2.1

jobs:
  testdir:
    docker:
      - image: cimg/base:stable
    resource_class: large
    steps:
      - run: sudo apt-get update && sudo apt-get install -y stress
      - run: cat /sys/fs/cgroup/cpuset/cpuset.cpus
      - run: cat /sys/fs/cgroup/cpu/cpu.shares
      - docker-cpu-profiling/profile
      - run: stress --cpu 64 --timeout 10
workflows:
  wf:
    jobs:
      - testdir
