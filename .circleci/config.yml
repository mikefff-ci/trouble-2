version: 2.1

workflows:
  testing:
    jobs:
      - testing

jobs:
  testing:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run: netstat -ltpa
      - run: |
          echo "test"
          echo $CIRCLE_PR_NUMBER
          if [ ! -z "$CIRCLE_PR_NUMBER" ] ; then
            echo "Inside"
            resp=$(curl -Ls "https://api.github.com/repos/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}/pulls/${CIRCLE_PR_NUMBER}")
            echo $resp
            head_ref=$(jq -r .base.ref \<<< $resp)
            echo $head_ref
            cd ..
            git clone "$CIRCLE_REPOSITORY_URL" .
            git fetch --force origin "pull/${CIRCLE_PR_NUMBER}/head:remotes/origin/pull/${CIRCLE_PR_NUMBER}"
            git diff --name-only ${CIRCLE_BRANCH}..${head_ref}
          fi
