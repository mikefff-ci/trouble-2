version: 2.1

orbs:
  end-of-the-jobs: mkly/end-of-the-jobs@dev:0.2.1
  slack: circleci/slack@3.4.2

jobs:
  stuff:
    docker:
      - image: cimg/base:stable
    steps:
      - run: echo "tedsdfsdfssdfsddd"
  morestuff:
    docker:
      - image: cimg/base:stable
    steps:
      - run: sleep 60
  evenmorestuff:
    docker:
      - image: cimg/base:stable
    steps:
      - run: sleep 24
      - run: exit 99

workflows:
  wf:
    jobs:
      - end-of-the-jobs/execute_on_end_workflow:
          pipeline_number: << pipeline.number >>
          pipeline_project_type: << pipeline.project.type >>
          on_complete_steps:
            - run: echo 123
            - run: echo "test"
            - slack/notify:
                include_visit_job_action: false
                include_job_number_field: false
                color: "$EOTJ_COLOR"
                message: "$EOTJ_JOB_MESSAGE"
                footer: "$EOTJ_WORKFLOW_URL"
      - evenmorestuff
      - morestuff:
          filters:
            branches:
              only: /branch_test/
      - stuff:
          requires:
            - evenmorestuff
