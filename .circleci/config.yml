version: 2.1

orbs:
  win: circleci/windows@1.0.0

jobs:
  build:
    machine:
      image: windows-server-2019-vs2019:stable
      resource_class: windows.medium
      shell: powershell.exe
    working_directory: ~/rss-velociraptor
    parameters:
      version:
        type: string
        default: "0.4.5"
    steps:
      - run:
          name: Install Wix
          command: choco install --nosilent wixtoolset
          shell: powershell.exe
          no_output_timeout: 1m
      - store_artifacts:
          path: C:\ProgramData\chocolatey\logs
          destination: chocolatey_logs
  loonix:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - run: |
          pyenv global 3.7.0
          curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
          unzip awscli-bundle.zip
          sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
          aws --version

workflows:
  wf:
    jobs:
      - build
      - loonix
